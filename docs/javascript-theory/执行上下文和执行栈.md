---
title: 执行上下文和执行栈
categories:
    - 前端基础
tags: 
    - javascript
date: 2020-11-08
---

## 执行上下文
### 基本概念
执行上下文是指javascript代码在解析和执行时所处环境的抽象概念
### 分类
1. 全局执行上下文
只有一个，浏览器中全局对象指的是window或者frames对象，this执行这个对象（webworks中全局对象是self）；node环境下是指global对象。ES2020中最新特性globalThis的提出就是为了解决不同环境下访问全局变量方法的不一致问题。
2. 函数执行上下文
有无数个，只有函数调用时才会创建，每次调用函数会创建新的函数执行上下文。
3. eval执行上下文
是指运行在eval函数中的代码，目前已不推荐使用。
### 执行上下文的创建过程
#### 创建阶段
1. 确定this的值，即this绑定：
在全局执行上下文中，this指向全局对象（浏览器中为window，nodejs中为global）;函数执行上下文中，若函数被对象调用则指向该对象，否则指向全局对象。
2. 创建词法环境组件
词法环境是一种规范类型，用于定义标识符与函数和变量之间的关联关系，由环境记录和外部环境引用构成。
环境记录是存储变量和函数的实际位置；外部环境引用是指它可以访问的外部环境记录。
```javascript
GlobalExectionContext = { // 全局执行上下文
  LexicalEnvironment: { // 词法环境
    EnvironmentRecord: { // 环境记录
      Type: "Object",  // 对象环境记录
      // 标识符绑定在这里
    }
    outer: <null>  // 无外部环境引用（null）
  }  
}

FunctionExectionContext = { // 函数执行上下文
  LexicalEnvironment: { // 词法环境
    EnvironmentRecord: { // 环境记录
      Type: "Declarative",  // 声明性环境记录
      // 标识符绑定在这里 
    }
    outer: <Global or outer function environment reference> // 全局或者外部环境引用
  }  
}
```
3. 创建变量环境组件
变量环境也是一种词法环境，具有其所有的属性。在ES6中两者的区别是词法环境用于存储函数声明和变量let、const的绑定，而变量环境只存储变量var的绑定。
#### 执行阶段
完成对变量的分配并最后执行代码


## 执行栈
### 基本概念
执行栈（调用栈）用于存储代码执行期间所创建的所有执行上下文，具有后进先出的结构（LIFO）
### 创建过程
1. js代码执行时会创建全局执行上下文并push到当前执行栈中
2. 某一函数执行时会创建该函数执行上下文并push到当前执行栈中
3. 当该函数执行完毕时由于执行栈后进先出的特点，会pop当前函数执行上下文，控制权回到下一个执行上下文中










